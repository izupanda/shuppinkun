<!DOCTYPE html>
<html lang="en">

<head>
  <!-- CSS  -->
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="css/styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
  <!-- JavaScript -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <link rel="icon" href="images/favicon.ico">
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <title>出品手伝いくん</title>
</head>

<body>
  <div class="wrapper">
    <div class="sidebar">
      <div class="logocontainer">
        <a class="navbar-brand" href="index.html"><img src="images/logo.svg" alt="ロゴ" width="140px"></a>
      </div>
      <ul>
        <li class="menucontent activemenu">
          <img src="images/generateicon-a.svg" alt="商品情報を作る" width="72px"> <img src="images/done.svg" alt="商品情報を作る"
            width="24px" class="doneicon"> 商品情報を作る
        </li>
        <li class="menucontent"><a href="price.html"><img src="images/priceicon.svg" alt="商品情報を作る" width="72px">
          参考価格を調べる</a> </li>
        <li class="menucontent">
          <a href="list.html">
            <img src="images/listicon.svg" alt="商品情報を作る" width="80px">代わりに出品する
          </a>
        </li>
      </ul>
    </div>
    <div class="content">
      <div class="generate-container">
        <div class="titlecontainer">
          商品情報を作る
        </div>
        <!-- 商品タイトルを表示するテキストエリア -->
        <div class="form-group align-items-center">
          <div class="s-titlecontainer">

            <label for="productTitle" class="m-0">商品タイトル</label>
            <button type="button" onclick="copyToClipboard('#productTitle')" class="ml-auto">
              <i class="fas fa-copy"></i>
            </button>

          </div>
          <div class="product-title"></div>
          <textarea id="productTitle" class=" w-100 mt-2"></textarea>
        </div>
      </div>
      <!-- 商品説明文を表示するテキストエリア -->
      <div class="generate-container">
        <div class="form-group align-items-center">
          <div class="s-titlecontainer">

            <label for="productDescription" class="m-0">商品説明文</label>
            <button type="button" onclick="copyToClipboard('#productDescription')" class="ml-auto">
              <i class="fas fa-copy"></i>
            </button>
          </div>
          <textarea id="productDescription" class="productDescription w-100 mt-2"></textarea>
          <button type="button" id="nextButton" class="mt-2">次へ進む →</button>
        </div>
      </div>
      <script>
        function copyToClipboard(elementId) {
          const el = document.querySelector(elementId);
          const range = document.createRange();
          range.selectNodeContents(el);
          const sel = window.getSelection();
          sel.removeAllRanges();
          sel.addRange(range);
          document.execCommand('copy');
          alert("コピーしました");
        }


        $(function () {
          // ページ読み込み時にlocalStorageから商品説明文と商品タイトルを取得
          let defaultDescription = '商品説明文がここに表示されます。';
          let defaultTitle = '商品タイトルがここに表示されます。';

          let storedDescription = localStorage.getItem('generatedDescription') || defaultDescription;
          let storedTitle = localStorage.getItem('generatedTitle') || defaultTitle;

          $('#productDescription').val(storedDescription);
          $('#productTitle').val(storedTitle);

          // サーバーからのレスポンスを処理
          // サーバーからのレスポンスを処理
          $.ajax({
            url: "/get-price",
            type: "GET",
            data: {
              query: localStorage.getItem('productName')
            },
            success: function (response) {
              // responseはサーバーからのレスポンス。
              // この例では、GPT-3からの生成結果が response に直接含まれていると仮定しています。

              let generatedText = response;

              // 正規表現を用いて商品タイトルと商品説明文を分割
              let titlePattern = /&#8203;``oaicite:{"number":1,"invalid_reason":"Malformed citation 【商品タイトル】"}``&#8203;\s*([\s\S]*?)\s*&#8203;``oaicite:{"number":2,"invalid_reason":"Malformed citation 【商品説明文】"}``&#8203;/;
              let descriptionPattern = /&#8203;``oaicite:{"number":3,"invalid_reason":"Malformed citation 【商品説明文】"}``&#8203;\s*([\s\S]*)/;

              let titleMatch = generatedText.match(titlePattern);
              let descriptionMatch = generatedText.match(descriptionPattern);

              let title = titleMatch ? titleMatch[1].trim() : "デフォルトの商品タイトル";
              let description = descriptionMatch ? descriptionMatch[1].trim() : "デフォルトの商品説明文";

              // 商品タイトルと商品説明文をテキストエリアにセット
              $('#productTitle').val(title);
              $('#productDescription').val(description);
            }
          });

        });
      </script>

    </div>
  </div>
  </div>
</body>

</html>